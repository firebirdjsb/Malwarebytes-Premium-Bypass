:: ==================================================
::  Malwarebytes-Premium-Reset v12.6
:: ==================================================
::  Dev  - Scut1ny
::  Help - AmmarSAA & firebirdjsb
::  Link - https://github.com/Scrut1ny/Malwarebytes-Premium-Reset
:: ==================================================


@echo off
title Malwarebytes-Premium-Reset ^| v12.6

:: Check for administrator privileges
fltmc >nul 2>&1 || (
    echo( && echo   [33m# Administrator privileges are required. && echo([0m
    PowerShell Start -Verb RunAs '%0' 2> nul || (
        echo   [33m# Right-click on the script and select "Run as administrator".[0m
        >nul pause && exit 1
    )
    exit 0
)

:: Script

cls && echo( && echo   [94mMalwarebytes[0m: [33mPremium[0m - [[31mBYPASS[0m]
echo   --------------------------------&& echo(

echo   [+] Killing certain Mbam Processes!
start "" "%ProgramFiles%\Malwarebytes\Anti-Malware\malwarebytes_assistant.exe" --stopservice

echo Processes have been Killed. && timeout /t 5 >nul
cls && echo( && echo   [94mMalwarebytes[0m: [33mPremium[0m - [[31mBYPASS[0m]
echo   --------------------------------&& echo(


REM Backup specified files to a new folder on the user's desktop
set "backupFolder=%USERPROFILE%\Desktop\Malwarebytes_Backup"
if not exist "%backupFolder%" (
    mkdir "%backupFolder%"
)
echo Backing Up Certain Mbam Files && timeout /t 5 >nul
REM Copy files to backup folder (overwrite if they exist)
copy /Y "C:\ProgramData\Malwarebytes\MBAMService\config\ArwControllerConfig.json" "%backupFolder%" >nul
copy /Y "C:\ProgramData\Malwarebytes\MBAMService\config\ScanConfig.json" "%backupFolder%" >nul
copy /Y "C:\ProgramData\Malwarebytes\MBAMService\config\RtpConfig.json" "%backupFolder%" >nul
cls && echo( && echo   [94mMalwarebytes[0m: [33mPremium[0m - [[31mBYPASS[0m]
echo   --------------------------------&& echo(

echo   [+] Querying scheduled task...&& timeout /t 5 >nul

"%SystemRoot%\System32\schtasks.exe" /query /tn "Malwarebytes-Premium-Reset" >nul 2>&1

if %errorlevel% equ 0 (
    echo( && echo [[93m![0m] Scheduled task already exists
    echo   [+] Deleting old task... && timeout /t 5 >nul
    schtasks /delete /tn "Malwarebytes-Premium-Reset" /f >nul 2>&1
    echo   [+] Old task deleted.  && timeout /t 2 >nul
)

echo   [+] Creating scheduled task...  && timeout /t 3 >nul
for /f %%a in ('powershell -c "[guid]::NewGuid().ToString()"') do (
    reg add "HKLM\SOFTWARE\Microsoft\Cryptography" /v "MachineGuid" /t REG_SZ /d "%%a" /f >nul
)

schtasks /create /tn "Malwarebytes-Premium-Reset" /tr "\"%comspec%\" /c \"echo Task executed\"" /sc daily /mo 13 /rl highest >nul 2>&1
echo   [+] Scheduled task created. && timeout /t 3 >nul
cls && echo( && echo   [94mMalwarebytes[0m: [33mPremium[0m - [[31mBYPASS[0m]
echo   --------------------------------&& echo(
echo   [+] Running the task...  && timeout /t 5 >nul
schtasks /run /tn "Malwarebytes-Premium-Reset" >nul 2>&1
echo   [+] Task executed. && timeout /t 5 >nul

cls && echo( && echo   [94mMalwarebytes[0m: [33mPremium[0m - [[31mBYPASS[0m]
echo   --------------------------------&& echo(

REM Restoring backed-up files to Malwarebytes folder && timeout /t 5 >nul
echo   [+] Restoring backed-up files to Malwarebytes folder... && timeout /t 5 >nul

copy /Y "%USERPROFILE%\Desktop\Malwarebytes_Backup\ArwControllerConfig.json" "C:\ProgramData\Malwarebytes\MBAMService\config\" >nul
IF NOT ERRORLEVEL 0 (
    echo   [!] Failed to restore ArwControllerConfig.json && timeout /t 5 >nul
    REM Handle error, check permissions, or file locking issues
) ELSE (
    echo   [+] ArwControllerConfig.json restored successfully. && timeout /t 5 >nul
)

copy /Y "%USERPROFILE%\Desktop\Malwarebytes_Backup\ScanConfig.json" "C:\ProgramData\Malwarebytes\MBAMService\config\" >nul
IF NOT ERRORLEVEL 0 (
    echo   [!] Failed to restore ScanConfig.json && timeout /t 5 >nul
    REM Handle error, check permissions, or file locking issues
) ELSE (
    echo   [+] ScanConfig.json restored successfully. && timeout /t 5 >nul
)

copy /Y "%USERPROFILE%\Desktop\Malwarebytes_Backup\RtpConfig.json" "C:\ProgramData\Malwarebytes\MBAMService\config\" >nul
IF NOT ERRORLEVEL 0 (
    echo   [!] Failed to restore RtpConfig.json && timeout /t 5 >nul
    REM Handle error, check permissions, or file locking issues
) ELSE (
    echo   [+] RtpConfig.json restored successfully. && timeout /t 5 >nul
)
cls && echo( && echo   [94mMalwarebytes[0m: [33mPremium[0m - [[31mBYPASS[0m]
echo   --------------------------------&& echo(
echo   [+] Restarting Mbam Processes... && timeout /t 3 >nul
start "" "%ProgramFiles%\Malwarebytes\Anti-Malware\mbam.exe" >nul 2>&1 && timeout /t 5  >nul

RD /S /Q "%USERPROFILE%\Desktop\Malwarebytes_Backup" >nul 2>&1 && timeout /t 5 >nul
IF ERRORLEVEL 1 (
    echo   [!] Failed to delete backup folder.
    REM Handle error or permissions issue if necessary
) ELSE (
    echo   [+] Backup folder deleted successfully.
)
echo   [+] Done, thank you for use this trial resetter.
echo(&&pause
